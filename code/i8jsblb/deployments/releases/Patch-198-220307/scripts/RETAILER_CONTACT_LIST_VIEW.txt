
  CREATE OR REPLACE FORCE VIEW "I8_MICROBANK_JS_PROD"."RETAILER_CONTACT_LIST_VIEW" ("SERVICE_OPERATOR_ID", "DISTRIBUTOR_ID", "DISTRIBUTOR_NAME", "DISTRIBUTOR_LEVEL_ID", "DISTRIBUTOR_LEVEL_NAME", "RETAILER_CONTACT_ID", "RETAILER_ID", "IS_ACTIVE", "VERSION_NO", "DESCRIPTION", "BALANCE", "IS_RSO", "BUSINESS_NAME", "USERNAME", "EMAIL", "APP_USER_ID", "FIRST_NAME", "LAST_NAME", "MOBILE_NO", "RETAILER_NAME", "REGION_ID", "REGION_NAME", "AREA_ID", "AREA_NAME", "AREA_LEVEL_ID", "AREA_LEVEL_NAME", "BUSINESS_CITY_ID", "BUSINESS_CITY_NAME", "RETAILER_ADDRESS", "IS_ACCOUNT_ENABLED", "PARTNER_GROUP_ID", "PARTNER_GROUP_NAME", "DEVICE_TYPE_ID", "ALLPAY_ID", "IS_HEAD", "HEAD_STRING", "NIC", "IS_ACCOUNT_ACTIVE", "IS_ACCOUNT_LOCKED", "IS_CREDENTIALS_EXPIRED", "IS_ACCOUNT_CLOSED", "CREATED_ON", "SALES_HIERARCHY_ID", "SALES_USER_NAME") AS 
  SELECT DISTRIBUTOR.SERVICE_OP_ID,
   DISTRIBUTOR.DISTRIBUTOR_ID,
          DISTRIBUTOR.NAME AS DISTRIBUTOR_NAME,
          DISTRIBUTOR_LEVEL.DISTRIBUTOR_LEVEL_ID,
          DISTRIBUTOR_LEVEL.name AS DISTRIBUTOR_LEVEL_NAME,
          RETAILER_CONTACT.RETAILER_CONTACT_ID,
          RETAILER_CONTACT.RETAILER_ID,
          RETAILER_CONTACT.IS_ACTIVE,
          RETAILER_CONTACT.VERSION_NO,
          RETAILER_CONTACT.DESCRIPTION,
          RETAILER_CONTACT.BALANCE,
          RETAILER_CONTACT.IS_RSO,
          RETAILER_CONTACT.BUSINESS_NAME,
          APP_USER.USERNAME,
          APP_USER.EMAIL,
          APP_USER.APP_USER_ID,
          APP_USER.FIRST_NAME,
          APP_USER.LAST_NAME,
          APP_USER.MOBILE_NO,
          RETAILER.NAME RETAILER_NAME,
          amd.region_id,
          region.REGION_NAME,
          amd.area_id,
          area.name AS area_name,
          amd.AREA_LEVEL_ID,
          AREA_LEVEL.AREA_LEVEL_NAME,
          address.city_id AS business_city_id,
          city.name AS business_city_name,
          address.STREET_ADDRESS AS RETAILER_ADDRESS,
          APP_USER.IS_ACCOUNT_ENABLED,
          pg.PARTNER_GROUP_ID,
          PG.NAME AS PARTNER_GROUP_NAME,
          USER_DEVICE_ACCOUNTS.DEVICE_TYPE_ID,
          USER_DEVICE_ACCOUNTS.USER_ID AS ALLPAY_ID,
          RETAILER_CONTACT.IS_HEAD,
          CASE
             WHEN    RETAILER_CONTACT.IS_HEAD IS NULL
                  OR RETAILER_CONTACT.IS_HEAD = 0
             THEN
                'No'
             ELSE
                'Yes'
          END
             AS HEAD_STRING,
          APP_USER.NIC,
          (CASE
              WHEN user_device_accounts.is_account_enabled = 1
              THEN
                 'ACTIVATED'
              WHEN user_device_accounts.is_account_enabled = 0
              THEN
                 'DE-ACTIVATED'
           END)
             AS is_account_active,
          (CASE
              WHEN user_device_accounts.IS_ACCOUNT_LOCKED = 0 THEN 'UNLOCKED'
              WHEN user_device_accounts.IS_ACCOUNT_LOCKED = 1 THEN 'LOCKED'
           END)
             AS IS_ACCOUNT_LOCKED,
          (CASE
              WHEN user_device_accounts.IS_CREDENTIALS_EXPIRED = 0
              THEN
                 'NOT EXPIRED'
              WHEN user_device_accounts.IS_CREDENTIALS_EXPIRED = 1
              THEN
                 'EXPIRED'
           END)
             AS IS_CREDENTIALS_EXPIRED,
          (CASE
              WHEN     app_user.IS_CLOSED_UNSETTLED = 0
                   AND app_user.IS_CLOSED_SETTLED = 0
              THEN
                 'OPEN'
              WHEN     app_user.IS_CLOSED_UNSETTLED = 1
                   AND app_user.IS_CLOSED_SETTLED = 0
              THEN
                 'CLOSED UNSETTLED'
              WHEN     app_user.IS_CLOSED_UNSETTLED = 1
                   AND app_user.IS_CLOSED_SETTLED = 1
              THEN
                 'CLOSED SETTLED'
           END)
             AS is_account_closed,
          RETAILER.CREATED_ON,
          RETAILER_CONTACT.SALES_HIERARCHY_ID,
          sau.first_name || ' ' || sau.last_name AS SALES_USER_NAME
     FROM RETAILER_CONTACT,
          APP_USER,
          app_user sau,
          SALES_HIERARCHY sh,
          AREA,
          AREA_LEVEL,
          RETAILER,
          USER_DEVICE_ACCOUNTS,
          RETAILER_CONTACT_ADDRESSES RCA,
          agent_merchant_detail amd,
          address,
          city,
          distributor,
          distributor_level,
          region,
          app_user_partner_group appg,
          partner_group pg
    WHERE     USER_DEVICE_ACCOUNTS.APP_USER_ID(+) = APP_USER.APP_USER_ID
          AND RETAILER_CONTACT.SALES_HIERARCHY_ID = sh.SALES_HIERARCHY_ID(+)
          AND sau.app_user_id(+) = sh.bank_user_id
          AND USER_DEVICE_ACCOUNTS.device_type_id(+) = 5
          AND appg.app_user_id = app_user.app_user_id
          AND pg.partner_group_id = appg.partner_group_id
          AND address.city_id = city.city_id(+)
          AND AREA.AREA_Id(+) = amd.area_id
          AND area_level.area_level_id(+) = amd.area_level_id
          AND region.region_id(+) = amd.region_id
          AND distributor.distributor_id(+) = amd.distributor_id
          AND amd.INITIAL_APP_FORM_NUMBER(+) =
                 RETAILER_CONTACT.initial_app_form_number
          AND city.city_id(+) = address.city_id
          AND address.address_id(+) = rca.address_id
          AND rca.retailer_contact_id = retailer_contact.retailer_contact_id
          AND RETAILER_CONTACT.RETAILER_CONTACT_ID(+) =
                 APP_USER.RETAILER_CONTACT_ID
          AND RETAILER.RETAILER_ID = RETAILER_CONTACT.RETAILER_ID
          AND RETAILER_CONTACT.distributor_level_id =
                 distributor_level.distributor_level_id(+)
          AND rca.address_type_id = 5
          AND rca.applicant_type_id IS NULL;
