
  CREATE OR REPLACE FORCE VIEW "HANDLER_ACTIVITY_REPORT_VIEW" ("PK", "JSCASH_ACCOUNT_NO", "CORE_ACCOUNT_NO", "PAYMENT_MODE", "DEBIT_CARD_NUMBER", "ACCOUNT_TYPE_ID", "ACCOUNT_TYPE", "AGENT_BUSINESS_NAME", "FIRST_NAME", "LAST_NAME", "ADDRESS", "CNIC", "MOBILE_NO", "FILER_STATUS", "AGENT_NETWORK", "REIGON", "AREA", "AREA_LEVEL_NAME", "RETAILER_CONTACT_ID", "CITY", "TAX_REGIME_ID", "TAX_REGIME", "SALES_USER_NAME", "AGENT_LEVEL", "IS_MAIN_AGENT", "HANDLER_AGENT_ID", "ACCOUNT_OPENING_DATE", "TRANSACTION_TYPE", "TRANSACTION_COUNT", "TRANSACTION_AMOUNT", "TRANSACTION_SUMMARY_DATE", "ACCOUNT_CLOSING_DATE", "JCASH_ACCOUNT_STATUS", "CORE_ACCOUNT_STATUS", "CREDENTIALS_EXPIRED", "ACCOUNT_BALANCE", "MAIN_AGENT_ID") AS 
  SELECT  ROWNUM AS PK, AG.MOBILE_NO AS JSCASH_ACCOUNT_NO ,B.ACCOUNT_NO AS  CORE_ACCOUNT_NO, U.NAME AS PAYMENT_MODE,'' DEBIT_CARD_NUMBER,
   E.CUSTOMER_ACCOUNT_TYPE_ID AS ACCOUNT_TYPE_ID,
    E.NAME AS ACCOUNT_TYPE, G.BUSINESS_NAME AS  AGENT_BUSINESS_NAME, A.FIRST_NAME, A.LAST_NAME,
    C.ADDRESS, A.NIC AS CNIC, A.MOBILE_NO,
    (CASE A.IS_FILER WHEN 1 THEN 'FILER' ELSE 'NON-FILER' END) AS FILER_STATUS,
    I.NAME AS AGENT_NETWORK, J.REGION_NAME AS REIGON, K.NAME AS AREA, L.AREA_LEVEL_NAME,  G.RETAILER_CONTACT_ID, O.NAME AS CITY,
    P.TAX_REGIME_ID, P.NAME AS TAX_REGIME, A.FIRST_NAME || ' ' || A.LAST_NAME AS SALES_USER_NAME,
    Q.NAME AS AGENT_LEVEL, CASE NVL(G.IS_HEAD,0) WHEN 0 THEN 'NO' ELSE 'YES' END AS  IS_MAIN_AGENT,
    T.USER_ID AS HANDLER_AGENT_ID, R.CREATED_ON AS ACCOUNT_OPENING_DATE,
    T.PRODUCT_NAME AS TRANSACTION_TYPE, T.TRANSACTION_COUNT AS TRANSACTION_COUNT, T.TRANSACTION_AMOUNT AS TRANSACTION_AMOUNT,
    T.TRANSACTION_SUMMARY_DATE, A.ACCOUNT_CLOSED_ON AS ACCOUNT_CLOSING_DATE,
     CASE NVL(D.STATUS_ID,0) WHEN 1 THEN 'ACTIVE' ELSE 'IN ACTIVE' END AS JCASH_ACCOUNT_STATUS,
     CASE NVL(B.IS_ACTIVE,0) WHEN 1 THEN 'ACTIVE' ELSE 'IN ACTIVE' END AS CORE_ACCOUNT_STATUS,
     CASE NVL(A.IS_CREDENTIALS_EXPIRED,0) WHEN 1 THEN 'YES' ELSE 'NO' END AS CREDENTIALS_EXPIRED,
     D.BALANCE AS ACCOUNT_BALANCE, S.USER_ID AS MAIN_AGENT_ID

    FROM APP_USER AG 
       INNER JOIN HANDLER F ON F.PRIMARY_RETAILER_CONTACT_ID = AG.RETAILER_CONTACT_ID 
       INNER JOIN APP_USER A ON A.HANDLER_ID = F.HANDLER_ID
       INNER JOIN ACCOUNT_INFO B ON B.CUSTOMER_ID = AG.APP_USER_ID
       INNER JOIN ACCOUNT_HOLDER C ON C.MOBILE_NUMBER = AG.MOBILE_NO
       INNER JOIN ACCOUNT D ON  D.ACCOUNT_HOLDER_ID = C.ACCOUNT_HOLDER_ID
       --
       INNER JOIN RETAILER_CONTACT G ON G.RETAILER_CONTACT_ID = AG.RETAILER_CONTACT_ID
       INNER JOIN RETAILER R ON R.RETAILER_ID = G.RETAILER_ID
       INNER JOIN PAYMENT_MODE U ON B.PAYMENT_MODE_ID = U.PAYMENT_MODE_ID
       INNER JOIN OLA_CUSTOMER_ACCOUNT_TYPE E ON E.CUSTOMER_ACCOUNT_TYPE_ID = F.ACCOUNT_TYPE_ID
       INNER JOIN AGENT_MERCHANT_DETAIL H ON H.INITIAL_APP_FORM_NUMBER = G.INITIAL_APP_FORM_NUMBER
       INNER JOIN DISTRIBUTOR I ON H.DISTRIBUTOR_ID = I.DISTRIBUTOR_ID
       INNER JOIN REGION J ON J.REGION_ID = H.REGION_ID
       INNER JOIN AREA K ON K.AREA_ID = H.AREA_ID
       INNER JOIN AREA_LEVEL L ON L.AREA_LEVEL_ID = H.AREA_LEVEL_ID
       INNER JOIN RETAILER_CONTACT_ADDRESSES M ON G.RETAILER_CONTACT_ID = M.RETAILER_CONTACT_ID
       INNER JOIN ADDRESS N ON M.ADDRESS_ID = N.ADDRESS_ID
       INNER JOIN CITY O ON O.CITY_ID = N.CITY_ID
       INNER JOIN TAX_REGIME P ON P.TAX_REGIME_ID = G.TAX_REGIME_ID
       LEFT JOIN DISTRIBUTOR_LEVEL Q ON Q.DISTRIBUTOR_LEVEL_ID = G.DISTRIBUTOR_LEVEL_ID
       INNER JOIN USER_DEVICE_ACCOUNTS S ON AG.APP_USER_ID = S.APP_USER_ID
       INNER JOIN USER_DEVICE_ACCOUNTS T ON A.APP_USER_ID = T.APP_USER_ID
       LEFT  JOIN (SELECT COUNT(*) TRANSACTION_COUNT, SUM(TD.TRANSACTION_AMOUNT) TRANSACTION_AMOUNT,
                    TRUNC(TD.CREATED_ON) TRANSACTION_SUMMARY_DATE, TD.MFS_ID, TD.PRODUCT_NAME
                   FROM TRANSACTION_DETAIL_MASTER TD
                     WHERE SUP_PROCESSING_STATUS_ID = 1
                   GROUP BY TD.MFS_ID, TD.PRODUCT_NAME, TRUNC(TD.CREATED_ON)) T ON T.MFS_ID = S.USER_ID

WHERE
    AG.APP_USER_TYPE_ID = 3
    AND B.IS_ACTIVE = 1
    AND A.APP_USER_TYPE_ID = 12
    AND M.ADDRESS_TYPE_ID = 5
    AND D.STATUS_ID = 1
    AND M.APPLICANT_TYPE_ID IS NULL;
