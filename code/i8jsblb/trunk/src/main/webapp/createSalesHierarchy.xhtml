<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
	  xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich">

<h:head>
<link rel="stylesheet" href="#{request.contextPath}/styles/wizard_style.css" type="text/css" />
<link rel="stylesheet" href="#{request.contextPath}/styles/tpc.css" type="text/css" />
<link rel="stylesheet" href="#{request.contextPath}/styles/style_js.css" type="text/css" />
<meta name="title" content="Create Sales Hieararchy" />
 <style>
.col {
    width: 33%;
}
.centercol {
    width: 33%;
    text-align: center;
}
</style>
<script type="text/javascript" src="#{request.contextPath}/scripts/commonFormValidator.js"></script>
<script type="text/javascript" src="#{request.contextPath}/scripts/jquery-1.7.2.min.js"></script>
<script type="text/javascript" >
function openSaleUserHierarchy()
{
	var saleUserHierarchyError = document.getElementById("myform:saleUserHierarchyError").value;
	if(saleUserHierarchyError.match("false"))
	{
		var settings="help:no;status:no;maximize:no;minimize:no;dialogHeight:455px;dialogWidth:600px;edge:sunken;scroll:no;center:yes;resizable:no";
   	   	var returnValue = window.showModalDialog("parentSaleUserHierarchy.faces", "",settings);
   	   	if(returnValue == 'Success')
   	   	{
   	   		document.getElementById("myform:refresher").click();
   	   	}
   	   	else
   	   	{
   	   		document.getElementById("myform:clearNodeSelection").click();
   	   	}
	}
}

function openSaleUserHistory()
{
		var settings="help:no;status:no;maximize:no;minimize:no;dialogHeight:450px;dialogWidth:950px;edge:sunken;scroll:no;center:yes;resizable:no";
   	   	var returnValue = window.showModalDialog("salesHierarchyHistory.faces", "",settings);
}
</script>
</h:head>
<h:body>
<f:view>
	<h:form id="myform">	
		<a4j:commandButton id="refresher" style="display:none;" actionListener="#{salesHierarchyActionBean.reRenderFields}" render="parentSaleUser, parentSaleUserId, loadSalesHierarchyBtn" />
		<a4j:commandButton id="clearNodeSelection" style="display:none;" actionListener="#{salesHierarchyActionBean.clearNodeSelection}" />
		
		<h:inputHidden id="rowIndex" value="" />
		<div id="wizard_group"> 
        	<table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr>
	                <td id="header_wizard"><h1>Create Sales Hierarchy</h1></td>
                </tr>
            	<tr>
                	<td>
                        <div id="status_bar_top">
                        	<table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                  <td width="70%" valign="top" align="left">
                                  	<div id="ah_nav">
                                        <ul>
                                        </ul>
                                    </div>
                                  </td>
                                  <td width="30%" valign="top" align="right">
                                  	 <a4j:outputPanel id="icons_div" styleClass="icons_div" style="display:block;float:right;" >
                                        <a4j:commandLink actionListener="#{salesHierarchyActionBean.clearSalesHierarchyForm}" title="Clear"
                                            	render="saleUser roleTitle ultimateParentSaleUser parentSaleUser" >
                                         	<h:graphicImage url="/images/ah_images/icon_clear.png" title="Clear" />
                                        </a4j:commandLink> 
                                    </a4j:outputPanel>
                                  </td>
                              </tr>
                            </table>
                        </div>
                        <div class="clear"></div>
                    </td>
                </tr>
            	
                <tr>
                	<td >
                    	<div id="content_wrap">
                            <div class="row,error_text_red" style="margin-left: 30px" >
                                <a4j:outputPanel ajaxRendered="true">
                                    <a4j:outputPanel styleClass="error_cont" rendered="#{! empty facesContext.maximumSeverity}">
                                        <a4j:outputPanel>
                                            <a4j:outputPanel styleClass="error_txt" >
                                                <h:messages globalOnly="true" />
                                            </a4j:outputPanel>
                                        </a4j:outputPanel>
                                    </a4j:outputPanel>                
                                </a4j:outputPanel>
                            </div>
                            <table width="" border="0" align="center" cellpadding="0" cellspacing="10">
                            	<tr>
                                    <td width="170" valign="center">Sales User<span class="asterisk">*</span>:</td>
                                    <td width="200" align="left" valign="top">
                                    	<h:selectOneMenu id="saleUser" styleClass="type_list" 
                                            	value="#{salesHierarchyActionBean.salesHierarchyModel.bankUserId}" title="Sale User" >
                                        	<f:selectItem itemLabel="[select]" itemValue="-1" />
                                        	<f:selectItems value="#{salesHierarchyActionBean.appUsers}"/>
                                        	<a4j:ajax event="change" listener="#{salesHierarchyActionBean.onChangeSaleUser}" render="@form footer"/>
                                    	</h:selectOneMenu>
                                    </td>
                              	</tr>
                              	<tr>
                                    <td width="170" valign="center">Role Title<span class="asterisk">*</span>:</td>
                                    <td width="200" align="left" valign="top">
                                    	<h:inputText id="roleTitle" styleClass="type_txt" value="#{salesHierarchyActionBean.salesHierarchyModel.roleTitle}" maxlength="50" title="Role Title"
                                    	 onkeypress="return maskAlphaNumericWithSpdashforAH(this,event)" onkeydown="return disablePasteOption(event)"/>
                                    </td>
                              	</tr>
                              	<tr>
                                    <td width="170" valign="center">Ultimate Parent Sale User:</td>
                                    <td width="200" align="left" valign="top">
                                    	<h:selectOneMenu id="ultimateParentSaleUser" styleClass="type_list" 
                                            	value="#{salesHierarchyActionBean.salesHierarchyModel.ultimateParentBankUserId}" title="Ultimate Parent Sale User" >
                                        	<f:selectItem itemLabel="[select]" itemValue="-1" />
                                        	<f:selectItems value="#{salesHierarchyActionBean.ultimateAppUsers}"/>
                                        	
                                    	</h:selectOneMenu>
                                    </td>
                              	</tr>
                              	<tr>
                                    <td width="170" valign="center">Parent Sale User<span class="asterisk">*</span>:</td>
                                    <td width="200" align="left" valign="top">
                                    	<h:inputText readonly="true" id="parentSaleUser" title="Parent Sale User" 
                                    		value="#{salesHierarchyActionBean.salesHierarchyModel.parentBankUserName}" styleClass="type_lookup_txt"
                                   			disabled="#{salesHierarchyActionBean.salesHierarchyModel.editMode}" />
                                        <h:graphicImage id="loadSalesHierarchyBtn" url="/images/ah_images/lookup_22.png" style="cursor:pointer;border: 0px;" title="Select Parent Sale User" >
                                             <a4j:ajax event="click" listener="#{salesHierarchyActionBean.loadSaleUserHierarchy}" oncomplete="openSaleUserHierarchy();" render="saleUserHierarchyError" 
                                             	disabled="#{salesHierarchyActionBean.ultimateAppUsers.size() == 0}" execute="ultimateParentSaleUser saleUser"/>
                                        </h:graphicImage>
                                        <h:inputHidden id="parentSaleUserId" value="#{salesHierarchyActionBean.salesHierarchyModel.parentBankUserId}" />
                                        <h:inputHidden id="saleUserHierarchyError" value="#{salesHierarchyActionBean.saleUserHierarchyError}" />
                                    </td>
                              	</tr>
                              	<tr>
                              		<td colspan="2" valign="top">
                                	<h:selectBooleanCheckbox  id="active" styleClass="type_check" value="#{salesHierarchyActionBean.salesHierarchyModel.active}" title="Active">
                                		<a4j:ajax event="change" listener="#{salesHierarchyActionBean.onChangeActive}" render="active"/>
                                	</h:selectBooleanCheckbox>	 
	                                <label>Active</label>               
                                </td>
                              	</tr>
                              	<tr id="btnRow">
                              		<td colspan="2" align="right">
                              		<!-- <h:commandButton styleClass="btn" id="btnRetag" value="Re-tag" rendered="#{salesHierarchyActionBean.alreadyAssociated}"></h:commandButton> -->
                              		<a4j:commandLink id="historyBtn" style="cursor:pointer;border: 0px;" title="Sales User History" >View History
                                       <a4j:ajax event="click" listener="#{salesHierarchyActionBean.loadSaleUserHistory}" oncomplete="openSaleUserHistory();" />
                                    </a4j:commandLink>
                              		</td>
                              	</tr>
                          </table>
                        </div>
                    </td>
                </tr>
		    	<tr>
                	<td id="status_bar_bottom">
                    	<div>
                            <a4j:outputPanel styleClass="infoMessage" ajaxRendered="true">
                                <h:outputText style="color:#ed1c24;" value="#{infoMessage}"/>
                            </a4j:outputPanel>
                        </div>
                    </td>
                </tr>
		    	<tr>
                	<td>
                    	<div id="footer">
                    	  <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    	    <tr>
                    	      <td width="50%" valign="top" align="left"></td>
                    	      <td width="50%" valign="top" align="right">
                    	      <h:commandLink styleClass="btn_save" 
                    	      	action="#{salesHierarchyActionBean.saveSalesHierarchy}" 
                    	      	rendered="#{(salesHierarchyActionBean.securityCheck or salesHierarchyActionBean.editSecurityCheck) and !salesHierarchyActionBean.alreadyAssociated}"/>
                    	      	<h:commandLink styleClass="btn_update" 
                    	      	action="#{salesHierarchyActionBean.saveSalesHierarchy}" 
                    	      	rendered="#{(salesHierarchyActionBean.securityCheck or salesHierarchyActionBean.editSecurityCheck) and salesHierarchyActionBean.alreadyAssociated}"/>
                              </td>
                  	      </tr>
                  	    </table>
                    	</div>
                  </td>
                </tr>
            </table>
		</div>
	</h:form>
	<div class="status">
        <a4j:status>
            <f:facet name="start">
                <h:graphicImage url="/images/ah_images/tabs_loader.gif" style="border:0px;"/>
            </f:facet>
            <f:facet name="stop"></f:facet>
        </a4j:status>
    </div>
</f:view>
</h:body>
</html>