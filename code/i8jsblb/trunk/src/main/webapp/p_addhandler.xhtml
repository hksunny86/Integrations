<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
        
<html xmlns="http://www.w3.org/1999/xhtml" 
	  xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"      
	  xmlns:c="http://java.sun.com/jsp/jstl/core">

<h:head>
<link rel="stylesheet" href="#{request.contextPath}/styles/wizard_style.css" type="text/css" />
<link rel="stylesheet" href="#{request.contextPath}/styles/tpc.css" type="text/css" />
<link rel="stylesheet" href="#{request.contextPath}/styles/style_js.css" type="text/css" />

<meta name="title" content="Add/Edit Handler" />

 <style>
.col {
    width:100px;
}
</style>
<script type="text/javascript" src="#{request.contextPath}/scripts/commonFormValidator.js"></script>
<script type="text/javascript" src="#{request.contextPath}/scripts/jquery-1.7.2.min.js"></script>

<script>

	/* function validateSelects(src) {
		
		var regionList = #{rich:element("regionList")};
		var agentNetwork = #{rich:element("agentNetwork")};
		var customerAccountType = #{rich:element("customerAccountTypeId")};
		var retailerContactId = #{rich:element("retailerContactId")};
				
		var errorDiv = document.getElementById("errorDiv");
		
		
		if(src == '2' &amp;&amp; agentNetwork.selectedIndex == 0) {
			errorDiv.innerHTML= 'Kindly Select Agent Network First';
			return false;
		}
		
		if(src == '3' &amp;&amp; regionList.selectedIndex == 0) {
			errorDiv.innerHTML= 'Kindly Select Region First';
			return false;
		}
		
		if(src == '4' &amp;&amp; retailerContactId.selectedIndex == 0) {
			errorDiv.innerHTML= 'Kindly Select Agent First';
			return false;
		}
		
		return true;
	} */


	function isReadOnly(src) {
	
		var errorDiv = document.getElementById("errorDiv");
		
		var fieldName = '';
		
		if(src == '1') {
			fieldName = 'Agent Network';
		}
		if(src == '2') {
			fieldName = 'Region';
		}
		if(src == '3') {
			fieldName = 'Agent';
		}
		if(src == '4') {
			fieldName = 'Account Type';
		}
	
		var readOnly = #{handlerManagedBean.handlerBackingBean.readOnly};
		if(readOnly) {
			errorDiv.innerHTML= fieldName + " is not updatable.";
			return false;
		}
		
		return true;
	}

	
	function validate() {	
	
		var readOnly = #{handlerManagedBean.handlerBackingBean.readOnly};
		var errorDiv = document.getElementById("errorDiv");
		errorDiv.innerHTML='';
				
		var agentName = #{rich:element("agentName")};
		var agentId = #{rich:element("agentMfsId")};
		var productCatalogId = #{rich:element("productCatalogId")};	
		
		var customerAccountType = #{rich:element("customerAccountTypeId")};		
		var userName = #{rich:element("userName")};			
		var cnicNumber = #{rich:element("cnicNumber")};		
		var firstName = #{rich:element("firstName")};
		var lastName = #{rich:element("lastName")};		
		var mobileNo = #{rich:element("mobileNo")};		
		
		if(agentId.value == '') {
			errorDiv.innerHTML= "Kindly Enter Agent ID";
			return false;
		}

		if(agentName.value == '') {
			errorDiv.innerHTML= "Kindly Press Fetch Name button";
			return false;
		}


		if(productCatalogId.selectedIndex == 0) {
			errorDiv.innerHTML= 'Kindly Select Product Catalog';
			return false;
		}	
		
		if(customerAccountType.selectedIndex == 0) {
			errorDiv.innerHTML= 'Kindly Select Account Type';
			return false;
		}		
		
		if(firstName.value == '') {
			errorDiv.innerHTML= "Kindly Enter First Name";
			return false;
		}	
		
		if(lastName.value == '') {
			errorDiv.innerHTML= "Kindly Enter Last Name";
			return false;
		}
		
		if(cnicNumber.value == '') {
			errorDiv.innerHTML="Kindly Enter CNIC";
			return false;
		}	
		
		if(cnicNumber.value.length != 13) {
			errorDiv.innerHTML="Kindly Enter Valid 13 Digit CNIC";
			return false;
		}
		
		if(!validateNumber(cnicNumber)) {
			errorDiv.innerHTML="Kindly Enter Correct 13 Digit CNIC";
			return false;
		}		
		
		if(mobileNo.value == '') {
			errorDiv.innerHTML="Kindly Enter Mobile #";
			return false;
		}	
		
		if(mobileNo.value.length != 11) {
			errorDiv.innerHTML="Kindly Enter Valid 11 Digit Mobile #";
			return false;
		}
		
		if(!validateNumber(mobileNo)) {
			errorDiv.innerHTML="Kindly Enter Correct 11 Digit Mobile #";
			return false;
		}
		
		if(userName.value == '') {
			errorDiv.innerHTML= "Kindly Enter Username";
			return false;
		}	

		if(userName.value.indexOf(' ') != -1) {
			errorDiv.innerHTML="Kindly Enter Valid Username '"+userName.value+"'";
			return false;
		}	
		
		return true;
	}
	
	
	function validateNumber(field){
			
		if(field.value==""){
			return false; 
		}

		var charpos = field.value.search("[^0-9]"); 
		
		if(charpos >= 0) { 
			return false; 
		} 
		return true;
	}

	function resetAgentName(){
  		document.getElementById('myform:agentName').value= '';
	} 	

	function checkAgentId(){
		var agentId = #{rich:element("agentMfsId")};
		if(agentId.value == '') {
			errorDiv.innerHTML= "Kindly Enter Agent ID";
			return false;
		}	
	} 
	
	
</script>

</h:head>
<h:body>
<f:view >

	<f:event type="preRenderView" listener="#{retailerBean.clearAllSessionObjects}"></f:event>

	<h:form id="myform" >	
		<div id="wizard_group"> 
        	<table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr>
	                <td id="header_wizard">
	                	<h1>
	                		<h:outputText value="Add/Edit Handler Details" />
	                	</h1>
	                </td>
                </tr>
            	<tr>
                	<td>
                        <div id="status_bar_top">
                        	<table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                  <td width="70%" valign="top" align="left">
                                  </td>
                                  <td width="30%" valign="top" align="right">
                                  	<a4j:outputPanel id="icons_div" styleClass="icons_div" style="display:block;float:right;" >
                                        <a4j:commandLink action="#{retailerBean.clearFranchiseForm}" title="Clear"
                                            rendered="#{!retailerBean.editMode}" disabled="#{!retailerBean.securityCheck and !retailerBean.editSecurityCheck}"
                                            render="distributor,city,comment,zip,brnachname,fax,active,contactname,address,permanentaddress,region,country,province,email,contactno,description">
                                         <h:graphicImage url="/images/ah_images/icon_clear.png" />   
                                        </a4j:commandLink> 
                                    </a4j:outputPanel>
                                  </td>
                              </tr>
                            </table>
                        </div>
                        <div class="clear"></div>
                    </td>
                </tr>
            	
                <tr>
                	<td align="center">
                    	<div id="content_wrap" >
                         <div class="error_txt" style="margin-left: 30px; font-size: xx-small;" id="errorDiv">
								<h:messages globalOnly="true" rendered="#{! empty facesContext.maximumSeverity}"  errorClass="error_txt"/>
                        </div>   
                        
                        <fieldset>
                            <legend>Primary Agent's Information</legend>
							<table border="0" width="80%">
   								<tr>
   									<td align="right"><span class="asterisk"> * </span>Agent ID:</td>
   									<td>
		                                <h:inputText readonly="#{handlerManagedBean.handlerBackingBean.readOnly}" styleClass="type_txt" id="agentMfsId" 
		                                	value="#{handlerManagedBean.handlerBackingBean.agentMfsId}" immediate="true"  onkeypress="return maskNumber(this,event)" onchange="resetAgentName()" maxlength="20" >              	
		                                </h:inputText>
   									</td>
   									<td align="right">
	   									<c:if test="#{handlerManagedBean.handlerBackingBean.readOnly}"> Agent Name:</c:if>
	   									<c:if test="#{!handlerManagedBean.handlerBackingBean.readOnly}">
	   										<h:commandButton id="fetchTitle" styleClass="btn" value="Fetch Title" onclick="return checkAgentId()">
	   											<a4j:actionListener listener="#{handlerManagedBean.fetchAgentName}"/>
	   										</h:commandButton>			
	   									</c:if>			
   									</td>
   									<td>
   										<h:inputText id="agentName" styleClass="type_txt" readonly="true" value="#{handlerManagedBean.handlerBackingBean.agentName}"></h:inputText>
   									</td>
   								</tr> 							
   								
   								<tr>
   									<td align="right"><span class="asterisk"> * </span>Account Type:</td>
   									<td>
	                                <h:selectOneMenu disabled="#{handlerManagedBean.handlerBackingBean.readOnly}" styleClass="type_list" id="customerAccountTypeId" value="#{handlerManagedBean.handlerBackingBean.customerAccountTypeId}" >
	                                	<f:selectItem itemValue="-1" itemLabel="Select Account Type" />
	                                    <f:selectItems value="#{handlerManagedBean.handlerBackingBean.customerAccountTypeList}"/>
	                                </h:selectOneMenu>         									
   									</td>
   									
   									<td align="right"><span class="asterisk"> * </span>Product Catalog:</td>
   									<td>
	                                <h:selectOneMenu styleClass="type_list" id="productCatalogId" value="#{handlerManagedBean.handlerBackingBean.productCatalogId}">
	                                	<f:selectItem itemValue="-1" itemLabel="Select Catalog" />
	                                    <f:selectItems value="#{handlerManagedBean.handlerBackingBean.productCatalogList}"/>
	                                </h:selectOneMenu>     									
   									</td>
   								</tr>     							
   								 
   								<tr>
   									<td align="right"></td>
   									<td>						
   									</td>
   									<td align="right">Comments:</td>
   									<td>
									<h:inputTextarea id="comments" value="#{handlerManagedBean.handlerBackingBean.handlerModel.comments}" styleClass="type_txt" rows="3"/> 									
   									</td>
   								</tr>   
   							</table>             						
                         </fieldset>
  
                    	<fieldset>
                    		<legend>Handler's Basic Information</legend>
                    		<table border="0" width="100%">
     								<tr>
     									<td align="right"><span class="asterisk"> * </span>First Name:</td>
     									<td><h:inputText id="firstName" maxlength="50" styleClass="type_txt"
     										onkeypress="return maskAlphaWithSp(this,event)" value="#{handlerManagedBean.handlerBackingBean.appUserModel.firstName}"/></td>
     									<td align="right"><span class="asterisk"> * </span>Last Name:</td>
     									<td><h:inputText maxlength="50" id="lastName" styleClass="type_txt"
     										onkeypress="return maskAlphaWithSp(this,event)" value="#{handlerManagedBean.handlerBackingBean.appUserModel.lastName}" /></td>
     								</tr>  
     								<tr>
     									<td align="right"><span class="asterisk"> * </span>Date of Birth:</td>
     									<td>
											<rich:calendar id="dob" datePattern="dd/MM/yyyy" inputClass="type_lookup_txt" 
											value="#{handlerManagedBean.handlerBackingBean.appUserModel.dob}" disabled="#{handlerManagedBean.handlerBackingBean.readOnly}"/>								
     									</td>
     									<td align="right">Birth Place:</td>
     									<td>
	                                		<h:inputText id="birthPlace" maxlength="50" styleClass="type_txt" 
	                                		onkeypress="return maskAlphaWithSp(this,event)" value="#{handlerManagedBean.handlerBackingBean.handlerModel.birthPlace}" />     									
     									</td>
     								</tr>     
     								<tr>
     									<td align="right"><span class="asterisk"> * </span>CNIC:</td>
     									<td>
	                                		<h:inputText disabled="#{handlerManagedBean.handlerBackingBean.readOnly}"  id="cnicNumber" maxlength="13"
	                                		 onkeypress="return maskNumber(this,event)"
	                                		 styleClass="type_txt" value="#{handlerManagedBean.handlerBackingBean.appUserModel.nic}" />
     									</td>
     									<td align="right"><span class="asterisk"> * </span>CNIC Expiry Date:</td>
     									<td>
											<rich:calendar id="expiryDate" datePattern="dd/MM/yyyy" inputClass="type_lookup_txt" value="#{handlerManagedBean.handlerBackingBean.appUserModel.nicExpiryDate}" disabled="false"/>								
     									</td>
     								</tr>
     								<tr>
     									<td align="right"><span class="asterisk"> * </span>Mobile #:</td>
     									<td>
			                                <h:inputText disabled="#{handlerManagedBean.handlerBackingBean.readOnly}" maxlength="11" id="mobileNo" 
			                                onkeypress="return maskNumber(this,event)"
			                                styleClass="type_txt" value="#{handlerManagedBean.handlerBackingBean.appUserModel.mobileNo}"/>  								
     									</td>
     									<td align="right">Active:</td>
     									<td>
	                                		<h:selectBooleanCheckbox id="active" value="#{handlerManagedBean.handlerBackingBean.handlerModel.active}" />     
	                                		<h:inputHidden id="handlerId" value="#{handlerManagedBean.handlerBackingBean.handlerModel.handlerId}"/>									
     									</td>
     								</tr>  
     								<tr>
     									<td align="right">SMS to Agent:</td>
     									<td>
											<h:selectBooleanCheckbox id="smsToAgent" value="#{handlerManagedBean.handlerBackingBean.handlerModel.smsToAgent}" />     									
     									</td>
     									<td align="right">SMS to Handler:</td>
     									<td>
             								<h:selectBooleanCheckbox id="smsToHandler" value="#{handlerManagedBean.handlerBackingBean.handlerModel.smsToHandler}" />                                     									
     									</td>
     								</tr>
     								<tr height="10" ><td colspan="4" height="10" >&nbsp;</td></tr>
     								<tr>
     									<td align="right" height="16" >BVS Enable:</td>
     									<td colspan="3">
											<h:selectBooleanCheckbox id="bvsEnable" value="#{handlerManagedBean.handlerBackingBean.handlerModel.bvsEnable}" />     									
     									</td>
     								</tr>
     						</table>	
                    	</fieldset>
                    	
                    	<fieldset>
                    		<legend>Handler's User Credentials</legend>
                    		<table border="0" width="80%">
   								<tr>
   									<td align="right"><span class="asterisk"> * </span>Username:</td>
   									<td><h:inputText maxlength="50" disabled="#{handlerManagedBean.handlerBackingBean.readOnly}"  id="userName" styleClass="type_txt" value="#{handlerManagedBean.handlerBackingBean.appUserModel.username}"/></td>
								</tr>     							
     						</table>
                    	</fieldset>
                    </div>
                    </td>
                </tr>

		    	<tr>
                	<td id="status_bar_bottom">
                    	<div class="infoMessage">
                          <a4j:outputPanel ajaxRendered="true">
                            <h:outputText id="infoMessage" value="#{infoMessage}"/>
                          </a4j:outputPanel>
                        </div>
                    </td>
                </tr>
		    	<tr>
                	<td>
                    	<div id="footer">
                    	  <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    	    <tr>
                    	      <td width="30%" valign="top" align="left"><h:commandLink styleClass="btn_cancel" value="" action="#{handlerManagedBean.cancel}"/></td>
                    	      <td width="50%" valign="top" align="right">
                    	      	<h:commandLink  styleClass="btn_save" value="" onclick="return validate()" render="icons_div" action="#{handlerManagedBean.execute}" />
                    	      </td>
                  	      </tr>
                  	    </table>
                    	</div>
                  </td>
                </tr>
            </table>
    	</div>
	</h:form>
						<div class="status">
                          <a4j:status>
                            <f:facet name="start">
                              <h:graphicImage url="/images/ah_images/tabs_loader.gif" style="border:0px;"/>
                            </f:facet>
                            <f:facet name="stop"></f:facet>
                          </a4j:status>
                        </div>
</f:view>

<script>	
	var errorDiv = document.getElementById("errorDiv");
	
	<c:if test="${param.created==1}">	
		errorDiv.innerHTML = 'Handler '+'#{handlerManagedBean.handlerBackingBean.appUserModel.username}'+ ' has been created successfully with User ID '+'#{param.userId}'+ '.';
	</c:if>
</script>

<script>	
	var errorDiv = document.getElementById("errorDiv");
	
	<c:if test="${param.created==3}">	
		errorDiv.innerHTML = 'Handler '+'#{handlerManagedBean.handlerBackingBean.appUserModel.username}'+ ' has been updated successfully.';
	</c:if>
</script>

</h:body>
</html>